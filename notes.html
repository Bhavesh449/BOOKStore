<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Viewport set to prevent accidental zooming of the UI elements on mobile -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Notes Viewer</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>

    <style>
        :root {
            --bg-color: #121212;
            --panel-bg: rgba(30, 30, 30, 0.95);
            --accent-color: #6c5ce7;
            --text-color: #e0e0e0;
            --btn-hover: rgba(255, 255, 255, 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent; /* Remove mobile tap blue box */
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            height: 100dvh; /* Dynamic viewport height for mobile */
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Toolbar --- */
        .toolbar {
            height: 60px;
            width: 100%;
            background: var(--panel-bg);
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            z-index: 100;
            flex-shrink: 0;
        }

        .brand {
            font-weight: 700;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .brand span { color: var(--accent-color); }

        .controls-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            background: transparent;
            border: none;
            color: #bbb;
            cursor: pointer;
            font-size: 1.1rem;
            width: 40px; /* Larger touch target */
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .btn:active { transform: scale(0.95); }
        .btn:hover { background: var(--btn-hover); color: #fff; }
        .btn:disabled { opacity: 0.3; pointer-events: none; }

        .page-info {
            font-size: 0.9rem;
            font-variant-numeric: tabular-nums;
            color: #888;
            user-select: none;
        }

        /* --- Viewer Area --- */
        #viewer-container {
            flex: 1;
            overflow: auto;
            position: relative;
            background-color: #000;
            display: flex;
            justify-content: center;
            /* Remove padding on mobile to maximize screen usage */
            padding: 20px; 
            touch-action: pan-x pan-y; /* Allow scrolling */
        }

        #pdf-render {
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            max-width: 100%;
            display: block;
        }

        /* --- Loader --- */
        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            pointer-events: none;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255,255,255,0.1);
            border-left-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* --- Mobile Responsive Queries --- */
        @media screen and (max-width: 768px) {
            .toolbar { padding: 0 10px; height: 55px; }
            
            /* Hide Brand on small screens, show only logo icon if really small */
            .brand-text { display: none; } 
            
            /* Tighten padding */
            #viewer-container { padding: 10px 0; align-items: flex-start; }
            
            /* Add some margin to the canvas on mobile so it doesn't touch edges perfectly */
            #pdf-render { margin-bottom: 20px; }
            
            .controls-group { gap: 5px; }
        }

        @media screen and (max-width: 400px) {
            /* On tiny screens, hide zoom buttons, prioritize nav */
            #zoom-in, #zoom-out { display: none; }
        }
    </style>
</head>
<body>

    <div class="toolbar">
        <div class="brand">
            <img src="logo.png" style="height:28px; width:auto;">
            <span style="color:#ffffff;" ><span class="brand-text">Notes</span>Viewer</span>

        </div>

        <!-- Navigation -->
        <div class="controls-group">
            <button class="btn" id="prev-page" title="Previous">
                <i class="fa-solid fa-chevron-left"></i>
            </button>
            <span class="page-info">
                <span id="page-num">1</span> / <span id="page-count">--</span>
            </span>
            <button class="btn" id="next-page" title="Next">
                <i class="fa-solid fa-chevron-right"></i>
            </button>
        </div>

        <!-- Tools -->
        <div class="controls-group">
            <button class="btn" id="zoom-out" title="Zoom Out">
                <i class="fa-solid fa-minus"></i>
            </button>
            <button class="btn" id="zoom-in" title="Zoom In">
                <i class="fa-solid fa-plus"></i>
            </button>
            <button class="btn" id="fullscreen-btn" title="Fullscreen">
    <i class="fa-solid fa-expand"></i>
</button>

            <button class="btn" id="download" title="Download">
                <i class="fa-solid fa-download"></i>
            </button>
        </div>
    </div>

    <div id="viewer-container">
        <canvas id="pdf-render"></canvas>
        
        <div class="loader" id="loader">
            <div class="spinner"></div>
        </div>

        <div id="error-message" style="display:none; text-align:center; margin-top:50px; color:#ff6b6b;">
            <i class="fa-solid fa-circle-exclamation" style="font-size: 2rem; margin-bottom:10px;"></i>
            <p>PDF Note Not Found</p>
        </div>
    </div>
<div id="note-title" style="
    position: fixed;
    bottom: 21px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(52, 152, 255, 0.15);
    padding: 10px 22px;
    border-radius: 14px;
    border: 1px solid rgba(52, 152, 255, 0.4);
    backdrop-filter: blur(6px);
    font-size: 1rem;
    color: #4dabff;
    pointer-events: none;
    z-index: 200;
    font-weight: 600;
    display: none;
    box-shadow: 0 4px 12px rgba(0,0,0,0.35);
">
    Life Processes L1
</div>


    <script>
        // Redirect if opened without any query (direct notes.html access)
if (!window.location.search || window.location.search.trim() === "") {
    window.location.href = "404.html";
}

        // --- Configuration ---
        
        const MAPPING = {
    'science/LifeProcesses-L1': "https://dxixtlyravvxx.cloudfront.net/540admin_v1/file_manager/pdf/477102786289055700.pdf",

    'sst/Devlopment': "https://dxixtlyravvxx.cloudfront.net/540admin_v1/file_manager/pdf/365223900581407600.pdf"
};


        let pdfDoc = null;
        let pageNum = 1;
        let pageRendering = false;
        let pageNumPending = null;
        let scale = 1.0; 
        let isAutoScaled = true; // Default to fitting screen width

        const canvas = document.getElementById('pdf-render');
        const ctx = canvas.getContext('2d');
        const loader = document.getElementById('loader');
        const container = document.getElementById('viewer-container');

        // --- URL Logic ---
        function getPdfUrl() {
            const queryString = window.location.search.substring(1);
            const decodedQuery = decodeURIComponent(queryString);
            if (MAPPING[decodedQuery]) return MAPPING[decodedQuery];
            for (let key in MAPPING) {
                if (decodedQuery.includes(key)) return MAPPING[key];
            }
            return null;
        }

        // --- Responsive Scale Logic ---
        function getFitToWidthScale(page) {
            const viewport = page.getViewport({ scale: 1.0 });
            // Get container width minus some padding (20px for desktop, 0 for mobile approx)
            const containerWidth = container.clientWidth - (window.innerWidth < 768 ? 0 : 40);
            
            // Calculate scale to fit width
            let newScale = containerWidth / viewport.width;
            
            // Don't let it get impossibly huge on large 4k monitors
            if (newScale > 2.5) newScale = 2.5;
            
            return newScale;
        }

        // --- Rendering ---
        function renderPage(num) {
            pageRendering = true;
            
            pdfDoc.getPage(num).then(function(page) {
                // If we are in "Auto" mode, recalculate scale based on screen width
                if (isAutoScaled) {
                    scale = getFitToWidthScale(page);
                }

                const viewport = page.getViewport({scale: scale});
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                const renderContext = {
                    canvasContext: ctx,
                    viewport: viewport
                };
                
                const renderTask = page.render(renderContext);

                renderTask.promise.then(function() {
                    pageRendering = false;
                    loader.style.display = 'none';
                    canvas.style.display = 'block';

                    // Scroll to top of page on mobile when turning pages
                    if(window.innerWidth < 768) {
                        container.scrollTop = 0;
                    }

                    if (pageNumPending !== null) {
                        renderPage(pageNumPending);
                        pageNumPending = null;
                    }
                });
            });

            document.getElementById('page-num').textContent = num;
            
            // Update buttons state
            document.getElementById('prev-page').disabled = num <= 1;
            document.getElementById('next-page').disabled = (pdfDoc && num >= pdfDoc.numPages);
        }

        function queueRenderPage(num) {
            if (pageRendering) {
                pageNumPending = num;
            } else {
                renderPage(num);
            }
        }

        function onPrevPage() {
            if (pageNum <= 1) return;
            pageNum--;
            queueRenderPage(pageNum);
        }

        function onNextPage() {
            if (pageNum >= pdfDoc.numPages) return;
            pageNum++;
            queueRenderPage(pageNum);
        }

        // --- Event Listeners ---
        document.getElementById('prev-page').addEventListener('click', onPrevPage);
        document.getElementById('next-page').addEventListener('click', onNextPage);

        document.getElementById('zoom-in').addEventListener('click', () => {
    isAutoScaled = false;
    scale = Math.min(scale + 0.2, 4);
    queueRenderPage(pageNum);
});


        document.getElementById('zoom-out').addEventListener('click', () => {
    isAutoScaled = false;
    scale = Math.max(scale - 0.2, 0.4);
    queueRenderPage(pageNum);
});


        document.getElementById('download').addEventListener('click', () => {
            const url = getPdfUrl();
            if(url) window.open(url, '_blank');
        });
// Show lesson title for science/LifeProcesses-L1
if (window.location.search.includes("science/LifeProcesses-L1")) {
    document.getElementById("note-title").style.display = "block";
}
// Show title for SST Development
if (window.location.search.includes("sst/Devlopment")) {
    const t = document.getElementById("note-title");
    t.innerText = "Development L1";
    t.style.display = "block";
}

        // --- Window Resize Handling ---
        // Debounce resize to prevent stuttering
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                if (pdfDoc && isAutoScaled) {
                    renderPage(pageNum);
                }
            }, 100);
        });

        // --- Touch Swipe Detection (Mobile) ---
        let touchStartX = 0;
        let touchEndX = 0;
        
        container.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        }, {passive: true});

        container.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        }, {passive: true});

        function handleSwipe() {
            // Threshold for swipe (50px)
            if (touchEndX < touchStartX - 50) onNextPage(); // Swiped Left -> Next
            if (touchEndX > touchStartX + 50) onPrevPage(); // Swiped Right -> Prev
        }

        // --- Initialization ---
        const url = getPdfUrl();

        if (!url) {
            loader.style.display = 'none';
            document.getElementById('error-message').style.display = 'block';
            document.querySelector('.toolbar').style.display = 'none';
        } else {
            pdfjsLib.getDocument(url).promise.then(function(pdfDoc_) {
                pdfDoc = pdfDoc_;
                document.getElementById('page-count').textContent = pdfDoc.numPages;
                renderPage(pageNum);
            }).catch(function(error) {
                loader.style.display = 'none';
                console.error(error);
                document.getElementById('error-message').innerHTML = `<p>Error: ${error.message}</p>`;
                document.getElementById('error-message').style.display = 'block';
            });
        }
        // --- Fullscreen Toggle ---
document.getElementById("fullscreen-btn").addEventListener("click", () => {
    if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
        document.getElementById("fullscreen-btn").innerHTML = '<i class="fa-solid fa-compress"></i>';
    } else {
        document.exitFullscreen();
        document.getElementById("fullscreen-btn").innerHTML = '<i class="fa-solid fa-expand"></i>';
    }
});

    </script>
</body>
</html>
